# omobaf - Open MOBA Frontend

å‡éŠæˆ²å‰ç«¯å®¢æˆ¶ç«¯ï¼Œç”¨æ–¼æ¸¬è©¦ `omobab` (Open MOBA Backend) å¾Œç«¯çš„éŠæˆ²é‚è¼¯ã€‚

## å°ˆæ¡ˆæ¦‚è¿°

`omobaf` æ˜¯ä¸€å€‹ Rust CLI å·¥å…·ï¼Œæ¨¡æ“¬çœŸå¯¦éŠæˆ²å®¢æˆ¶ç«¯è¡Œç‚ºï¼Œå°ˆæ³¨æ–¼è™•ç† MQTT éŠæˆ²è¨Šæ¯ï¼Œç”¨ä¾†é©—è­‰å¾Œç«¯éŠæˆ²é‚è¼¯æ˜¯å¦æ­£ç¢ºé‹ä½œã€‚

### ä¸»è¦ç‰¹è‰²

- ğŸ® **çœŸå¯¦éŠæˆ²æ¨¡æ“¬**: æ¨¡æ“¬çœŸå¯¦ç©å®¶çš„éŠæˆ²æ“ä½œè¡Œç‚º
- ğŸ“¡ **MQTT é€šä¿¡**: è™•ç†èˆ‡ omobab å¾Œç«¯çš„ MQTT è¨Šæ¯é€šä¿¡
- ğŸ¤– **è‡ªå‹•éŠæˆ²æ¨¡å¼**: æ”¯æ´è‡ªå‹•åŒ–æ“ä½œåºåˆ—æ¸¬è©¦
- ğŸ¯ **è‹±é›„æ”¯æ´**: æ”¯æ´é›œè³€å­«ä¸€å’Œä¼Šé”æ”¿å®—å…©å€‹è‹±é›„
- ğŸ› ï¸ **ç°¡æ½” CLI**: ç›´è§€çš„å‘½ä»¤è¡Œæ“ä½œä»‹é¢
- ğŸ“Š **ç‹€æ…‹åŒæ­¥**: æœ¬åœ°éŠæˆ²ç‹€æ…‹èˆ‡æœå‹™å™¨åŒæ­¥é©—è­‰

## å®‰è£å’Œå»ºç½®

### ç³»çµ±éœ€æ±‚

- Rust 1.70+
- é‹è¡Œä¸­çš„ `omobab` å¾Œç«¯æœå‹™
- MQTT Broker (é è¨­ä½¿ç”¨ 45.32.32.40:1883)

### å»ºç½®å°ˆæ¡ˆ

```bash
cd /mnt/d/Nobu/omobaf
cargo build --release
```

### é‹è¡Œ

```bash
# ä½¿ç”¨é è¨­è¨­å®š
./target/release/omobaf --help

# æˆ–ç›´æ¥ç”¨ cargo é‹è¡Œ
cargo run -- --help
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬å‘½ä»¤

#### 1. é€£æ¥åˆ°éŠæˆ²æœå‹™å™¨

```bash
omobaf connect --server-ip 45.32.32.40 --server-port 1883
```

#### 2. é–‹å§‹éŠæˆ²

```bash
# ä½¿ç”¨é›œè³€å­«ä¸€
omobaf play --hero saika_magoichi --player-name "TestPlayer1"

# ä½¿ç”¨ä¼Šé”æ”¿å®—
omobaf play --hero date_masamune --player-name "TestPlayer2"
```

#### 3. éŠæˆ²æ“ä½œ

```bash
# ç§»å‹•
omobaf move 300 200

# æ–½æ”¾æŠ€èƒ½
omobaf cast sniper_mode --x 350 --y 250 --level 1
omobaf cast saika_reinforcements --x 400 --y 300

# æ”»æ“Š
omobaf attack 450 350 --attack-type basic
```

#### 4. æŸ¥çœ‹ç‹€æ…‹

```bash
omobaf status
```

#### 5. è‡ªå‹•éŠæˆ²æ¨¡å¼

```bash
# è‡ªå‹•éŠæˆ² 60 ç§’
omobaf auto --duration 60
```

#### 6. åŸ·è¡Œæ¼”ç¤ºåºåˆ—

```bash
omobaf demo
```

#### 7. æŸ¥çœ‹å¯ç”¨æŠ€èƒ½

```bash
omobaf abilities
```

### æ”¯æ´çš„è‹±é›„å’ŒæŠ€èƒ½

#### é›œè³€å­«ä¸€ (saika_magoichi)
- `sniper_mode`: ç‹™æ“Šæ¨¡å¼
- `saika_reinforcements`: é›œè³€çœ¾ï¼ˆå¬å–šé›œè³€éµç‚®å…µï¼‰
- `rain_iron_cannon`: é›¨éµç‚®
- `three_stage_technique`: ä¸‰æ®µæ“Š

#### ä¼Šé”æ”¿å®— (date_masamune)
- `flame_blade`: ç«ç„°åˆ€
- `fire_dash`: ç«ç„°è¡åˆº
- `flame_assault`: ç«ç„°çªæ“Š
- `matchlock_gun`: ç«ç¹©æ§

### å®Œæ•´ä½¿ç”¨ç¯„ä¾‹

```bash
# 1. é€£æ¥ä¸¦é–‹å§‹éŠæˆ²
omobaf play --hero saika_magoichi --player-name "Player1" \
  --server-ip 45.32.32.40 --server-port 1883

# 2. ç§»å‹•åˆ°æˆ°å ´ä¸­å¤®
omobaf move 400 300

# 3. å¬å–šé›œè³€çœ¾
omobaf cast saika_reinforcements --x 450 --y 350

# 4. ä½¿ç”¨ç‹™æ“Šæ¨¡å¼
omobaf cast sniper_mode

# 5. æ”»æ“Šæ•µäºº
omobaf attack 500 400 --attack-type ranged

# 6. æŸ¥çœ‹ç•¶å‰ç‹€æ…‹
omobaf status

# 7. è‡ªå‹•éŠæˆ² 30 ç§’
omrobaf auto --duration 30
```

## ğŸ“š æ–‡æª”å°èˆª

è©³ç´°çš„æ¨¡çµ„æ–‡æª”è«‹åƒè€ƒä»¥ä¸‹é€£çµï¼š

- **[æºç¢¼æ¶æ§‹ç¸½è¦½](./src/README.md)** - æ‰€æœ‰æ¨¡çµ„çš„è©³ç´°èªªæ˜
- **[çµ‚ç«¯è¦–åœ–ç³»çµ±](./src/terminal_view/README.md)** - è¦–åœ–æ¸²æŸ“å’Œé¡¯ç¤ºç³»çµ±
- **[äº’å‹•æ¨¡å¼ç³»çµ±](./src/interactive/README.md)** - å³æ™‚éŠæˆ²æ§åˆ¶ç³»çµ±

## æ¶æ§‹è¨­è¨ˆ

### æ ¸å¿ƒçµ„ä»¶æ¦‚è¦½

å®Œæ•´çš„æ¶æ§‹èªªæ˜è«‹åƒè€ƒ **[æºç¢¼æ¶æ§‹æ–‡æª”](./src/README.md)**

- **BackendManager** - è‡ªå‹•ç®¡ç†å¾Œç«¯ç¨‹åºç”Ÿå‘½é€±æœŸï¼Œè¼¸å‡ºé‡å®šå‘åˆ° `backend.log`
- **GameClient** - éŠæˆ²å®¢æˆ¶ç«¯æ ¸å¿ƒï¼Œå”èª¿æ‰€æœ‰å­ç³»çµ±
- **MqttHandler** - MQTT ç¶²çµ¡é€šä¿¡å±¤
- **GameState** - æœ¬åœ°éŠæˆ²ç‹€æ…‹ç®¡ç†
- **TerminalView** - çµ‚ç«¯è¦–åœ–æ¸²æŸ“ç³»çµ± [è©³ç´°æ–‡æª”](./src/terminal_view/README.md)
- **Interactive** - äº’å‹•æ¨¡å¼æ§åˆ¶ç³»çµ± [è©³ç´°æ–‡æª”](./src/interactive/README.md)
- **Config** - é…ç½®ç®¡ç†ç³»çµ±
- **Player** - ç©å®¶å’Œè‹±é›„å®šç¾©

### MQTT è¨Šæ¯æ ¼å¼

#### ç›£è½ä¸»é¡Œ
- `td/+/send`: éŠæˆ²ç‹€æ…‹æ›´æ–°
- `ability_test/response`: èƒ½åŠ›æ¸¬è©¦å›æ‡‰

#### ç™¼é€ä¸»é¡Œ
- `td/{player_name}/action`: ç©å®¶æ“ä½œ

#### è¨Šæ¯æ ¼å¼
```json
{
  "t": "player_action",
  "a": "move",
  "d": {
    "target_x": 300.0,
    "target_y": 200.0
  }
}
```

## é…ç½®

### é…ç½®æ–‡ä»¶ (`config.toml`)

omobaf ä½¿ç”¨ `config.toml` ä½œç‚ºä¸»è¦é…ç½®æ–‡ä»¶ï¼š

```toml
[server]
# MQTT æœå‹™å™¨é…ç½®
mqtt_host = "127.0.0.1"  # MQTT Broker åœ°å€
mqtt_port = 1883          # MQTT Broker ç«¯å£

[backend]
# å¾Œç«¯åŸ·è¡Œæª”è·¯å¾‘ï¼ˆç›¸å°æˆ–çµ•å°è·¯å¾‘ï¼‰
executable_path = "../omobab/target/debug/omobab.exe"
# æˆ–ä½¿ç”¨ release ç‰ˆæœ¬
# executable_path = "../omobab/target/release/omobab.exe"

# å¾Œç«¯å•Ÿå‹•åƒæ•¸
args = []

# å·¥ä½œç›®éŒ„ï¼ˆå¯é¸ï¼Œé è¨­ç‚ºå¾Œç«¯åŸ·è¡Œæª”æ‰€åœ¨ç›®éŒ„ï¼‰
working_directory = "../omobab"

# ç’°å¢ƒè®Šæ•¸è¨­å®šï¼ˆå¯é¸ï¼‰
[backend.env]
RUST_LOG = "info"
# RUST_BACKTRACE = "1"

[frontend]
# å‰ç«¯è¨­å®š
player_name = "TestPlayer"
hero_type = "saika_magoichi"  # æˆ– "date_masamune"

# è‡ªå‹•å•Ÿå‹•å¾Œç«¯ï¼ˆé‡è¦åŠŸèƒ½ï¼‰
auto_start_backend = true

# å¾Œç«¯å•Ÿå‹•å»¶é²ï¼ˆæ¯«ç§’ï¼‰- ç­‰å¾…å¾Œç«¯åˆå§‹åŒ–
backend_start_delay = 1000

# å¾Œç«¯é—œé–‰ç­‰å¾…æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰
backend_shutdown_timeout = 5000
```

### å‘½ä»¤è¡Œåƒæ•¸

å‘½ä»¤è¡Œåƒæ•¸æœƒè¦†è“‹é…ç½®æ–‡ä»¶è¨­å®šï¼š

- `--server-ip`: MQTT æœå‹™å™¨ IP
- `--server-port`: MQTT æœå‹™å™¨ç«¯å£
- `--client-id`: MQTT å®¢æˆ¶ç«¯ ID
- `--player-name`: ç©å®¶åç¨±
- `--hero`: è‹±é›„é¡å‹
- `--verbose`: è©³ç´°æ—¥èªŒè¼¸å‡º
- `--no-auto-backend`: ç¦ç”¨è‡ªå‹•å•Ÿå‹•å¾Œç«¯

## å·¥ä½œæµç¨‹

### å•Ÿå‹•æµç¨‹

1. **è®€å–é…ç½®**ï¼šå¾ `config.toml` è¼‰å…¥é…ç½®
2. **å¾Œç«¯ç®¡ç†**ï¼š
   - å¦‚æœ `auto_start_backend = true`ï¼Œè‡ªå‹•å•Ÿå‹• omobab å¾Œç«¯
   - æ¸…ç†èˆŠçš„å¾Œç«¯é€²ç¨‹ï¼ˆWindows: taskkillï¼ŒUnix: pkillï¼‰
   - å°‡å¾Œç«¯è¼¸å‡ºé‡å®šå‘åˆ° `backend.log`
   - ç­‰å¾…å¾Œç«¯åˆå§‹åŒ–ï¼ˆé è¨­ 1000msï¼‰
3. **MQTT é€£æ¥**ï¼šé€£æ¥åˆ° MQTT Broker
4. **éŠæˆ²åˆå§‹åŒ–**ï¼šåˆå§‹åŒ–éŠæˆ²ç‹€æ…‹å’Œè¦–åœ–ç³»çµ±
5. **é€²å…¥éŠæˆ²å¾ªç’°**ï¼šè™•ç†ç”¨æˆ¶è¼¸å…¥å’Œæœå‹™å™¨è¨Šæ¯

### é—œé–‰æµç¨‹

1. ä¿å­˜éŠæˆ²ç‹€æ…‹ï¼ˆå¦‚éœ€è¦ï¼‰
2. æ–·é–‹ MQTT é€£æ¥
3. å¦‚æœå¾Œç«¯æ˜¯ç”±å‰ç«¯å•Ÿå‹•çš„ï¼Œè‡ªå‹•é—œé–‰å¾Œç«¯ç¨‹åº
4. æ¸…ç†æ‰€æœ‰ omobab é€²ç¨‹ï¼ˆç¢ºä¿æ²’æœ‰éºç•™é€²ç¨‹ï¼‰

### è¨Šæ¯æµç¨‹

```
ç”¨æˆ¶è¼¸å…¥ â†’ CLI/Interactive â†’ GameClient â†’ MqttHandler â†’ MQTT Broker
                                â†“
                            GameState
                                â†“
                          TerminalView â†’ çµ‚ç«¯é¡¯ç¤º

MQTT Broker â†’ MqttHandler â†’ GameState â†’ TerminalView â†’ çµ‚ç«¯æ›´æ–°
```

## é–‹ç™¼å’Œé™¤éŒ¯

### æ—¥èªŒç³»çµ±

```bash
# è©³ç´°æ—¥èªŒ
omobaf --verbose play --hero saika_magoichi

# æˆ–è¨­ç½®ç’°å¢ƒè®Šæ•¸
RUST_LOG=debug omobaf play --hero saika_magoichi

# æŸ¥çœ‹å¾Œç«¯æ—¥èªŒ
tail -f backend.log
```

### å¤šå®¢æˆ¶ç«¯æ¸¬è©¦

```bash
# çµ‚ç«¯ 1
omobaf play --player-name "Player1" --client-id "client_1" --hero saika_magoichi

# çµ‚ç«¯ 2  
omobaf play --player-name "Player2" --client-id "client_2" --hero date_masamune
```

### èª¿è©¦æŠ€å·§

1. **å¾Œç«¯æ—¥èªŒ**ï¼šæ‰€æœ‰å¾Œç«¯è¼¸å‡ºéƒ½åœ¨ `backend.log`
2. **å‰ç«¯æ—¥èªŒ**ï¼šä½¿ç”¨ `--verbose` æˆ– `RUST_LOG=debug`
3. **MQTT ç›£æ§**ï¼šä½¿ç”¨ mosquitto_sub ç›£æ§è¨Šæ¯
   ```bash
   mosquitto_sub -h 127.0.0.1 -t "td/+/send" -v
   ```
4. **ç‹€æ…‹æª¢æŸ¥**ï¼šä½¿ç”¨ `status` å‘½ä»¤æŸ¥çœ‹éŠæˆ²ç‹€æ…‹

## æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **é€£æ¥å¤±æ•—**
   - æª¢æŸ¥ MQTT Broker æ˜¯å¦é‹è¡Œ
   - é©—è­‰ IP å’Œç«¯å£è¨­å®š
   - æª¢æŸ¥ç¶²è·¯é€£æ¥

2. **æŠ€èƒ½æ–½æ”¾å¤±æ•—**
   - ç¢ºèªæŠ€èƒ½ ID æ­£ç¢º
   - æª¢æŸ¥è‹±é›„é¡å‹åŒ¹é…
   - æŸ¥çœ‹æœå‹™å™¨æ—¥èªŒ

3. **ç‹€æ…‹åŒæ­¥å•é¡Œ**
   - æª¢æŸ¥ MQTT è¨Šæ¯æ ¼å¼
   - ç¢ºèªä¸»é¡Œè¨‚é–±æ­£ç¢º
   - æŸ¥çœ‹åŒæ­¥éŒ¯èª¤è¨ˆæ•¸

### æ—¥èªŒæª¢æŸ¥

```bash
# æŸ¥çœ‹è©³ç´°æ—¥èªŒ
RUST_LOG=debug omobaf status --verbose
```

## ç‰¹æ®ŠåŠŸèƒ½

### çµ‚ç«¯è¦–åœ–ç³»çµ±

omobaf å¯¦ç¾äº†å®Œæ•´çš„çµ‚ç«¯è¦–åœ–ç³»çµ±ï¼Œå¯åœ¨å‘½ä»¤è¡Œä¸­é¡¯ç¤ºéŠæˆ²ç‹€æ…‹ï¼š

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        Game View                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘              @  (Player)                                      â•‘
â•‘              S  (é›œè³€çœ¾å¬å–šç‰©)                                â•‘
â•‘              *  (å…¶ä»–ç©å®¶)                                    â•‘
â•‘                                                               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Player: TestPlayer | HP: 100/100 | MP: 50/50 | Pos: (400,300)â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

è¦–åœ–åŠŸèƒ½ï¼š
- **è¦–å£è·Ÿéš¨**ï¼šè‡ªå‹•è·Ÿéš¨ç©å®¶ç§»å‹•
- **åæ¨™ç³»çµ±**ï¼šåœ°åœ–å¤§å° 800x600ï¼Œè¦–å£è‡ªå‹•èª¿æ•´
- **å¯¦é«”é¡¯ç¤º**ï¼šä¸åŒç¬¦è™Ÿä»£è¡¨ä¸åŒå¯¦é«”é¡å‹
- **ç‹€æ…‹æ¬„**ï¼šé¡¯ç¤ºç©å®¶è¡€é‡ã€é­”åŠ›ã€ä½ç½®ç­‰ä¿¡æ¯

### äº’å‹•æ¨¡å¼

é€²å…¥äº’å‹•æ¨¡å¼å¾Œï¼Œå¯ä½¿ç”¨ä»¥ä¸‹å¿«æ·éµï¼š
- `w/a/s/d`: ç§»å‹•è§’è‰²
- `q/e/r/f`: æ–½æ”¾æŠ€èƒ½
- `space`: åŸºç¤æ”»æ“Š
- `v`: åˆ‡æ›è¦–åœ–æ¨¡å¼
- `ESC`: é€€å‡º

### è‡ªå‹•åŒ–æ¸¬è©¦

omobaf æ”¯æ´å¤šç¨®è‡ªå‹•åŒ–æ¸¬è©¦æ¨¡å¼ï¼š

1. **è‡ªå‹•éŠæˆ²æ¨¡å¼** (`auto` å‘½ä»¤)
   - è‡ªå‹•ç§»å‹•ã€æ”»æ“Šã€æ–½æ”¾æŠ€èƒ½
   - å¯è¨­å®šé‹è¡Œæ™‚é•·

2. **æ¼”ç¤ºæ¨¡å¼** (`demo` å‘½ä»¤)
   - åŸ·è¡Œé è¨­çš„æ“ä½œåºåˆ—
   - å±•ç¤ºæ‰€æœ‰åŠŸèƒ½

3. **æ‰¹é‡æ¸¬è©¦**
   - å¯ç·¨å¯«è…³æœ¬æ‰¹é‡åŸ·è¡Œæ¸¬è©¦
   - æ”¯æ´å¤šå®¢æˆ¶ç«¯ä¸¦ç™¼æ¸¬è©¦

## æŠ€è¡“è¦æ ¼

- **èªè¨€**: Rust 2021 Edition
- **ç•°æ­¥é‹è¡Œæ™‚**: Tokio
- **MQTT å®¢æˆ¶ç«¯**: rumqttc
- **CLI æ¡†æ¶**: clap 4.0
- **åºåˆ—åŒ–**: serde + serde_json
- **æ•¸å­¸åº«**: vek
- **æ—¥èªŒ**: log + env_logger
- **çµ‚ç«¯æ§åˆ¶**: crossterm
- **é…ç½®ç®¡ç†**: toml

## æˆæ¬Š

èˆ‡ `omobab` å°ˆæ¡ˆç›¸åŒçš„é–‹æºæˆæ¬Šã€‚

## è²¢ç»

æ­¡è¿æäº¤ Issue å’Œ Pull Request ä¾†æ”¹é€²é€™å€‹å°ˆæ¡ˆã€‚

---

**æ³¨æ„**: é€™æ˜¯ä¸€å€‹ç”¨æ–¼æ¸¬è©¦å’Œé–‹ç™¼çš„å·¥å…·ï¼Œä¸é©ç”¨æ–¼ç”Ÿç”¢ç’°å¢ƒã€‚