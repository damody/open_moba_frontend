# omobaf æºç¢¼æ¶æ§‹

æœ¬ç›®éŒ„åŒ…å« omobaf å‰ç«¯çš„æ‰€æœ‰æºç¢¼æ¨¡çµ„ã€‚æ¯å€‹æ¨¡çµ„éƒ½æœ‰å…¶ç‰¹å®šåŠŸèƒ½å’Œè·è²¬ã€‚

## ğŸ“ æ¨¡çµ„çµæ§‹

### æ ¸å¿ƒæ¨¡çµ„

- **`main.rs`** - ç¨‹å¼å…¥å£é»
  - åˆå§‹åŒ–é…ç½®å’Œæ—¥èªŒç³»çµ±
  - è™•ç†å‘½ä»¤è¡Œåƒæ•¸
  - å•Ÿå‹•å¾Œç«¯ç®¡ç†å™¨ï¼ˆå¦‚æœé…ç½®å•Ÿç”¨ï¼‰
  - å”èª¿å„æ¨¡çµ„é‹è¡Œ

- **`game_client.rs`** - éŠæˆ²å®¢æˆ¶ç«¯æ ¸å¿ƒ
  - ç®¡ç†æ•´å€‹éŠæˆ²æœƒè©±ç”Ÿå‘½é€±æœŸ
  - æ•´åˆ MQTTã€éŠæˆ²ç‹€æ…‹ã€çµ‚ç«¯è¦–åœ–
  - è™•ç†ç©å®¶æ“ä½œå’Œæœå‹™å™¨éŸ¿æ‡‰
  - åæ¨™ç³»çµ±ï¼š2D åæ¨™ (x, y)ï¼Œåœ°åœ–å¤§å° 800x600

- **`backend_manager.rs`** - å¾Œç«¯ç¨‹åºç®¡ç†å™¨
  - è‡ªå‹•å•Ÿå‹•/åœæ­¢ omobab å¾Œç«¯
  - å°‡å¾Œç«¯è¼¸å‡ºé‡å®šå‘åˆ° `backend.log`
  - æ¸…ç†èˆŠé€²ç¨‹ï¼ˆWindows: taskkillï¼ŒUnix: pkillï¼‰
  - ç¨‹åºé€€å‡ºæ™‚è‡ªå‹•æ¸…ç†

### ç¶²çµ¡é€šä¿¡

- **`mqtt_handler.rs`** - MQTT è¨Šæ¯è™•ç†å™¨
  - ç®¡ç† MQTT é€£æ¥å’Œé‡é€£
  - è¨‚é–±ä¸»é¡Œï¼š
    - `td/+/send` - éŠæˆ²ç‹€æ…‹æ›´æ–°
    - `ability_test/response` - èƒ½åŠ›æ¸¬è©¦éŸ¿æ‡‰
  - ç™¼å¸ƒä¸»é¡Œï¼š
    - `td/{player_name}/action` - ç©å®¶æ“ä½œ
  - è¨Šæ¯æ ¼å¼ï¼šJSON

### éŠæˆ²é‚è¼¯

- **`game_state.rs`** - éŠæˆ²ç‹€æ…‹ç®¡ç†
  - ç¶­è­·æœ¬åœ°éŠæˆ²ç‹€æ…‹
  - è¿½è¹¤ç©å®¶ã€å¬å–šç‰©ã€å…¶ä»–å¯¦é«”
  - ç‹€æ…‹åŒæ­¥å’Œé©—è­‰
  - å†·å»æ™‚é–“ç®¡ç†

- **`player.rs`** - ç©å®¶å’Œè‹±é›„å®šç¾©
  - è‹±é›„é¡å‹å®šç¾©ï¼ˆé›œè³€å­«ä¸€ã€ä¼Šé”æ”¿å®—ï¼‰
  - èƒ½åŠ›å®šç¾©å’Œå±¬æ€§
  - ç©å®¶ç‹€æ…‹çµæ§‹

### ç”¨æˆ¶ä»‹é¢

- **`cli.rs`** - å‘½ä»¤è¡Œä»‹é¢
  - ä½¿ç”¨ clap 4.0 å®šç¾©å‘½ä»¤çµæ§‹
  - æ”¯æ´å­å‘½ä»¤ï¼šplayã€moveã€castã€attackã€statusã€autoã€demo
  - åƒæ•¸è§£æå’Œé©—è­‰

- **`terminal_logger.rs`** - æ—¥èªŒç³»çµ±
  - è‡ªå®šç¾©æ—¥èªŒæ ¼å¼åŒ–
  - æ”¯æ´ä¸åŒæ—¥èªŒç´šåˆ¥
  - å½©è‰²è¼¸å‡ºï¼ˆå¦‚æœçµ‚ç«¯æ”¯æ´ï¼‰

### é…ç½®ç®¡ç†

- **`config.rs`** - é…ç½®ç³»çµ±
  - è®€å–å’Œè§£æ `config.toml`
  - é…ç½®çµæ§‹å®šç¾©
  - é è¨­å€¼å’Œé©—è­‰

## ğŸ“‚ å­æ¨¡çµ„

### terminal_view/ - çµ‚ç«¯è¦–åœ–ç³»çµ±
å®Œæ•´çš„çµ‚ç«¯éŠæˆ²è¦–åœ–å¯¦ç¾ã€‚[è©³ç´°æ–‡æª”](./terminal_view/README.md)

- `mod.rs` - æ¨¡çµ„å…¥å£å’Œå…¬å…±ä»‹é¢
- `viewport.rs` - è¦–å£ç®¡ç†å’Œåæ¨™è½‰æ›
- `renderer.rs` - æ¸²æŸ“é‚è¼¯
- `display.rs` - çµ‚ç«¯é¡¯ç¤ºç®¡ç†
- `input.rs` - éµç›¤è¼¸å…¥è™•ç†

### interactive/ - äº’å‹•æ¨¡å¼ç³»çµ±
æä¾›å³æ™‚äº’å‹•éŠæˆ²é«”é©—ã€‚[è©³ç´°æ–‡æª”](./interactive/README.md)

- `mod.rs` - æ¨¡çµ„å…¥å£
- `session.rs` - æœƒè©±ç®¡ç†
- `commands.rs` - å‘½ä»¤è™•ç†

## ğŸ”„ è³‡æ–™æµ

```
main.rs 
  â”œâ”€> backend_manager.rs (è‡ªå‹•å•Ÿå‹•å¾Œç«¯)
  â”œâ”€> config.rs (è¼‰å…¥é…ç½®)
  â””â”€> game_client.rs
       â”œâ”€> mqtt_handler.rs (ç¶²çµ¡é€šä¿¡)
       â”œâ”€> game_state.rs (ç‹€æ…‹ç®¡ç†)
       â”œâ”€> terminal_view/ (è¦–è¦ºå‘ˆç¾)
       â””â”€> interactive/ (ç”¨æˆ¶äº’å‹•)
```

## ğŸ› ï¸ é–‹ç™¼æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½

1. **æ–°å¢è‹±é›„**ï¼šä¿®æ”¹ `player.rs`ï¼Œæ·»åŠ è‹±é›„é¡å‹å’Œèƒ½åŠ›å®šç¾©
2. **æ–°å¢å‘½ä»¤**ï¼šä¿®æ”¹ `cli.rs` å’Œ `interactive/commands.rs`
3. **æ–°å¢è¦–åœ–å…ƒç´ **ï¼šä¿®æ”¹ `terminal_view/renderer.rs`
4. **æ–°å¢è¨Šæ¯é¡å‹**ï¼šä¿®æ”¹ `mqtt_handler.rs` å’Œ `game_state.rs`

### èª¿è©¦å»ºè­°

- ä½¿ç”¨ `RUST_LOG=debug` ç’°å¢ƒè®Šæ•¸æŸ¥çœ‹è©³ç´°æ—¥èªŒ
- æª¢æŸ¥ `backend.log` æŸ¥çœ‹å¾Œç«¯è¼¸å‡º
- ä½¿ç”¨ mosquitto_sub ç›£æ§ MQTT è¨Šæ¯æµ

## ğŸ“ ç·¨ç¢¼è¦ç¯„

- ä½¿ç”¨ Rust 2021 Edition
- éµå¾ª Rust å®˜æ–¹ç·¨ç¢¼é¢¨æ ¼
- æ‰€æœ‰å…¬å…± API éœ€è¦æ–‡æª”è¨»é‡‹
- éŒ¯èª¤è™•ç†ä½¿ç”¨ `anyhow::Result`
- ç•°æ­¥æ“ä½œä½¿ç”¨ Tokio runtime